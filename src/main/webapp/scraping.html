<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Films</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <a class="retour" href="index.html">← Accueil</a>
        <h1>Films</h1>

        <!-- Barre de recherche -->
        <div class="search-bar">
            <input v-model="query"
                   placeholder="Titre du film…"
                   @keyup.enter="rechercher" />
            <button @click="rechercher" :disabled="chargement || !query.trim()">
                {{ chargement ? 'Recherche…' : 'Rechercher' }}
            </button>
        </div>

        <!-- Messages -->
        <p class="msg-error" v-if="erreur">{{ erreur }}</p>
        <p class="loading" v-else-if="chargement">Chargement…</p>

        <!-- Résultat -->
        <div class="film-card" v-else-if="film">
            <img v-if="film.poster && film.poster.imageUrl"
                 :src="film.poster.imageUrl"
                 :alt="film.title" />
            <div class="no-image" v-else>Pas d'image</div>

            <div class="details">
                <h2>{{ film.title }}</h2>
                <p class="year" v-if="film.publicationYear">{{ film.publicationYear }}</p>

                <template v-if="film.artists && film.artists.length > 0">
                    <h3>Artistes</h3>
                    <ul>
                        <li v-for="(a, i) in film.artists" :key="i">
                            {{ a.firstName }} {{ a.lastName }}
                        </li>
                    </ul>
                </template>
                <p v-else style="color:#aaa; font-size:0.9em;">Aucun artiste renseigné.</p>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
        // ─── URL de l'API ─────────────────────────────────────────────────────────
        // À remplacer par l'URL de la gateway quand elle sera disponible.
        const API_URL = 'http://localhost:8082/api/scrap/film'
        // ─────────────────────────────────────────────────────────────────────────

        Vue.createApp({
            data() {
                return {
                    query:      '',
                    film:       null,
                    chargement: false,
                    erreur:     null,
                }
            },

            methods: {
                async rechercher() {
                    const q = this.query.trim()
                    if (!q) return

                    this.chargement = true
                    this.erreur     = null
                    this.film       = null

                    try {
                        const res = await fetch(`${API_URL}?query=${encodeURIComponent(q)}`)
                        if (!res.ok) {
                            const err = await res.json().catch(() => ({}))
                            throw new Error(err.message || `Erreur ${res.status}`)
                        }
                        this.film = await res.json()
                    } catch (e) {
                        this.erreur = 'Impossible de récupérer le film : ' + e.message
                    } finally {
                        this.chargement = false
                    }
                }
            }
        }).mount('#app')
    </script>
</body>
</html>
