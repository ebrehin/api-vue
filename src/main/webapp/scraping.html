<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Films</title>
    <link rel="stylesheet" href="css.css" type="text/css">
    <style>
        body { font-family: sans-serif; max-width: 700px; margin: 40px auto; padding: 0 20px; }
        a.retour { font-size: 0.9em; color: #555; text-decoration: none; }
        a.retour:hover { text-decoration: underline; }
        h1 { border-bottom: 2px solid #333; padding-bottom: 10px; }

        /* Barre de recherche */
        .search-bar { display: flex; gap: 10px; margin: 24px 0; }
        .search-bar input { flex: 1; padding: 10px; font-size: 1em;
                            border: 1px solid #ccc; border-radius: 4px; }
        .search-bar button { padding: 10px 20px; font-size: 1em; cursor: pointer;
                             background: #3498db; color: white; border: none; border-radius: 4px; }
        .search-bar button:hover { background: #2980b9; }
        .search-bar button:disabled { background: #aaa; cursor: default; }

        /* Carte r√©sultat */
        .film-card { display: flex; gap: 24px; border: 1px solid #ccc;
                     border-radius: 6px; overflow: hidden; margin-top: 16px; }
        .film-card img { width: 180px; min-height: 260px; object-fit: cover;
                         background: #eee; flex-shrink: 0; display: block; }
        .film-card .details { padding: 20px; }
        .film-card h2 { margin: 0 0 6px; }
        .film-card .year { color: #888; font-size: 0.9em; margin-bottom: 16px; }
        .film-card h3 { margin: 0 0 8px; font-size: 1em; color: #555; }
        .film-card ul { margin: 0; padding-left: 20px; }
        .film-card ul li { margin-bottom: 4px; }

        /* Messages */
        .msg-error { color: #c0392b; background: #fde; border: 1px solid #f9c;
                     padding: 10px; border-radius: 4px; margin-top: 16px; }
        .loading { color: #888; font-style: italic; margin-top: 16px; }
        .no-image { background: #ddd; width: 180px; min-height: 260px;
                    display: flex; align-items: center; justify-content: center;
                    color: #aaa; font-size: 0.85em; flex-shrink: 0; }
    </style>
</head>
<body>
    <div id="app">
        <a class="retour" href="index.html">‚Üê Accueil</a>
        <h1>üé¨ Films</h1>

        <!-- Barre de recherche -->
        <div class="search-bar">
            <input v-model="query"
                   placeholder="Titre du film‚Ä¶"
                   @keyup.enter="rechercher" />
            <button @click="rechercher" :disabled="chargement || !query.trim()">
                {{ chargement ? 'Recherche‚Ä¶' : 'Rechercher' }}
            </button>
        </div>

        <!-- Messages -->
        <p class="msg-error" v-if="erreur">{{ erreur }}</p>
        <p class="loading" v-else-if="chargement">Chargement‚Ä¶</p>

        <!-- R√©sultat -->
        <div class="film-card" v-else-if="film">
            <img v-if="film.poster && film.poster.imageUrl"
                 :src="film.poster.imageUrl"
                 :alt="film.title" />
            <div class="no-image" v-else>Pas d'image</div>

            <div class="details">
                <h2>{{ film.title }}</h2>
                <p class="year" v-if="film.publicationYear">{{ film.publicationYear }}</p>

                <template v-if="film.artists && film.artists.length > 0">
                    <h3>Artistes</h3>
                    <ul>
                        <li v-for="(a, i) in film.artists" :key="i">
                            {{ a.firstName }} {{ a.lastName }}
                        </li>
                    </ul>
                </template>
                <p v-else style="color:#aaa; font-size:0.9em;">Aucun artiste renseign√©.</p>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
        // ‚îÄ‚îÄ‚îÄ URL de l'API ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // √Ä remplacer par l'URL de la gateway quand elle sera disponible.
        const API_URL = 'http://localhost:8082/api/scrap/film'
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

        Vue.createApp({
            data() {
                return {
                    query:      '',
                    film:       null,
                    chargement: false,
                    erreur:     null,
                }
            },

            methods: {
                async rechercher() {
                    const q = this.query.trim()
                    if (!q) return

                    this.chargement = true
                    this.erreur     = null
                    this.film       = null

                    try {
                        const res = await fetch(`${API_URL}?query=${encodeURIComponent(q)}`)
                        if (!res.ok) {
                            const err = await res.json().catch(() => ({}))
                            throw new Error(err.message || `Erreur ${res.status}`)
                        }
                        this.film = await res.json()
                    } catch (e) {
                        this.erreur = 'Impossible de r√©cup√©rer le film : ' + e.message
                    } finally {
                        this.chargement = false
                    }
                }
            }
        }).mount('#app')
    </script>
</body>
</html>
