<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Posters</title>
    <link rel="stylesheet" href="css.css" type="text/css">
    <style>
        body { font-family: sans-serif; max-width: 900px; margin: 40px auto; padding: 0 20px; }
        a.retour { font-size: 0.9em; color: #555; text-decoration: none; }
        a.retour:hover { text-decoration: underline; }
        h1 { border-bottom: 2px solid #333; padding-bottom: 10px; }

        /* Grille de cartes */
        .posters-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin: 24px 0; }
        .poster-card { border: 1px solid #ccc; border-radius: 6px; overflow: hidden; }
        .poster-card img { width: 100%; height: 280px; object-fit: cover; display: block; background: #eee; }
        .poster-card .info { padding: 10px; }
        .poster-card .titre { font-weight: bold; margin-bottom: 4px; }
        .poster-card .id { font-size: 0.78em; color: #888; }
        .poster-card .actions { display: flex; gap: 6px; margin-top: 8px; }
        .poster-card .actions button { flex: 1; padding: 4px; font-size: 0.85em; cursor: pointer; }
        button.btn-danger { background: #e74c3c; color: white; border: none; border-radius: 4px; }
        button.btn-danger:hover { background: #c0392b; }
        button.btn-edit { background: #f0ad4e; color: white; border: none; border-radius: 4px; }
        button.btn-edit:hover { background: #e09d3e; }
        button.btn-primary { background: #3498db; color: white; border: none; border-radius: 4px;
                              padding: 8px 16px; cursor: pointer; font-size: 1em; }
        button.btn-primary:hover { background: #2980b9; }
        button.btn-secondary { background: #aaa; color: white; border: none; border-radius: 4px;
                               padding: 8px 16px; cursor: pointer; font-size: 1em; }

        /* Formulaire ajout / Ã©dition */
        .form-section { background: #f9f9f9; border: 1px solid #ddd; border-radius: 6px;
                        padding: 20px; margin-bottom: 24px; }
        .form-section h2 { margin-top: 0; }
        .form-row { display: flex; flex-direction: column; margin-bottom: 12px; }
        .form-row label { font-size: 0.9em; margin-bottom: 4px; color: #555; }
        .form-row input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 1em; }
        .form-actions { display: flex; gap: 10px; }

        /* Messages */
        .msg-error { color: #c0392b; background: #fde; border: 1px solid #f9c; padding: 10px;
                     border-radius: 4px; margin-bottom: 16px; }
        .msg-info { color: #27ae60; background: #efd; border: 1px solid #cec; padding: 10px;
                    border-radius: 4px; margin-bottom: 16px; }
        .loading { color: #888; font-style: italic; }
    </style>
</head>
<body>
    <div id="app">
        <a class="retour" href="index.html">â† Accueil</a>
        <h1>ğŸ–¼ï¸ Posters</h1>

        <!-- Messages -->
        <p class="msg-error" v-if="erreur">{{ erreur }}</p>
        <p class="msg-info"  v-if="confirmation">{{ confirmation }}</p>

        <!-- Formulaire : ajout ou Ã©dition -->
        <div class="form-section">
            <h2>{{ formulaire.mode === 'ajout' ? 'Ajouter un poster' : 'Modifier le poster' }}</h2>
            <div class="form-row">
                <label>ID</label>
                <input v-model="formulaire.id" :disabled="formulaire.mode === 'edition'"
                       placeholder="identifiant unique" />
            </div>
            <div class="form-row">
                <label>Titre</label>
                <input v-model="formulaire.titre" placeholder="titre du poster" />
            </div>
            <div class="form-row">
                <label>URL de l'image</label>
                <input v-model="formulaire.url" placeholder="https://..." />
            </div>
            <div class="form-actions">
                <button class="btn-primary" @click="soumettreFormulaire">
                    {{ formulaire.mode === 'ajout' ? 'Ajouter' : 'Enregistrer' }}
                </button>
                <button class="btn-secondary" v-if="formulaire.mode === 'edition'" @click="annulerEdition">
                    Annuler
                </button>
            </div>
        </div>

        <!-- Liste -->
        <p class="loading" v-if="chargement">Chargementâ€¦</p>
        <p v-else-if="posters.length === 0 && !erreur">Aucun poster pour l'instant.</p>
        <div class="posters-grid" v-else>
            <div class="poster-card" v-for="p in posters" :key="p.id">
                <img :src="p.url" :alt="p.titre" @error="imageErreur($event)" />
                <div class="info">
                    <div class="titre">{{ p.titre }}</div>
                    <div class="id">id : {{ p.id }}</div>
                    <div class="actions">
                        <button class="btn-edit"   @click="editer(p)">Modifier</button>
                        <button class="btn-danger" @click="supprimer(p.id)">Supprimer</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
        // â”€â”€â”€ URL de l'API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Ã€ remplacer par l'URL de la gateway quand elle sera disponible.
        const API_URL = 'http://localhost:8081/api/posters'
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        const App = {
            data() {
                return {
                    posters:      [],
                    chargement:   true,
                    erreur:       null,
                    confirmation: null,
                    formulaire: {
                        mode:  'ajout',   // 'ajout' | 'edition'
                        id:    '',
                        titre: '',
                        url:   '',
                    }
                }
            },

            created() {
                this.chargerPosters()
            },

            methods: {
                // â”€â”€ Lecture â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                async chargerPosters() {
                    this.chargement = true
                    this.erreur = null
                    try {
                        const res = await fetch(API_URL)
                        if (!res.ok) throw new Error(`Erreur ${res.status}`)
                        this.posters = await res.json()
                    } catch (e) {
                        this.erreur = 'Impossible de charger les posters : ' + e.message
                    } finally {
                        this.chargement = false
                    }
                },

                // â”€â”€ Formulaire â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                soumettreFormulaire() {
                    if (this.formulaire.mode === 'ajout') {
                        this.ajouterPoster()
                    } else {
                        this.modifierPoster()
                    }
                },

                editer(poster) {
                    this.formulaire.mode  = 'edition'
                    this.formulaire.id    = poster.id
                    this.formulaire.titre = poster.titre
                    this.formulaire.url   = poster.url
                    window.scrollTo({ top: 0, behavior: 'smooth' })
                },

                annulerEdition() {
                    this.formulaire = { mode: 'ajout', id: '', titre: '', url: '' }
                },

                // â”€â”€ Ajout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                async ajouterPoster() {
                    this.erreur = null
                    this.confirmation = null
                    const { id, titre, url } = this.formulaire
                    if (!id || !titre || !url) {
                        this.erreur = 'Tous les champs sont obligatoires.'
                        return
                    }
                    try {
                        const res = await fetch(API_URL, {
                            method:  'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body:    JSON.stringify({ id, titre, url })
                        })
                        if (!res.ok) {
                            const err = await res.json()
                            throw new Error(err.message || `Erreur ${res.status}`)
                        }
                        this.formulaire = { mode: 'ajout', id: '', titre: '', url: '' }
                        this.confirmation = 'Poster ajoutÃ© avec succÃ¨s.'
                        await this.chargerPosters()
                    } catch (e) {
                        this.erreur = e.message
                    }
                },

                // â”€â”€ Modification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                async modifierPoster() {
                    this.erreur = null
                    this.confirmation = null
                    const { id, titre, url } = this.formulaire
                    if (!titre || !url) {
                        this.erreur = 'Le titre et l\'URL sont obligatoires.'
                        return
                    }
                    try {
                        const res = await fetch(`${API_URL}/${id}`, {
                            method:  'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body:    JSON.stringify({ titre, url })
                        })
                        if (!res.ok) {
                            const err = await res.json()
                            throw new Error(err.message || `Erreur ${res.status}`)
                        }
                        this.annulerEdition()
                        this.confirmation = 'Poster modifiÃ© avec succÃ¨s.'
                        await this.chargerPosters()
                    } catch (e) {
                        this.erreur = e.message
                    }
                },

                // â”€â”€ Suppression â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                async supprimer(id) {
                    if (!confirm(`Supprimer le poster Â« ${id} Â» ?`)) return
                    this.erreur = null
                    this.confirmation = null
                    try {
                        const res = await fetch(`${API_URL}/${id}`, { method: 'DELETE' })
                        if (!res.ok) {
                            const err = await res.json()
                            throw new Error(err.message || `Erreur ${res.status}`)
                        }
                        this.confirmation = `Poster Â« ${id} Â» supprimÃ©.`
                        await this.chargerPosters()
                    } catch (e) {
                        this.erreur = e.message
                    }
                },

                // â”€â”€ Utilitaire â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                imageErreur(event) {
                    event.target.style.background = '#ddd'
                    event.target.style.height = '80px'
                }
            }
        }

        Vue.createApp(App).mount('#app')
    </script>
</body>
</html>
